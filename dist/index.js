import{defineComponent as t,ref as e,inject as r,computed as n,resolveComponent as o,openBlock as a,createElementBlock as i,createVNode as s,normalizeClass as l,withCtx as c,createBlock as u,createCommentVNode as d,createTextVNode as p,toDisplayString as h}from"vue";import{useRouter as f}from"vue-router";import{useStores as v,useApi as y}from"@directus/extensions-sdk";import{useI18n as m}from"vue-i18n";var g=(0).constructor,b=g.isFinite;g.isInteger;var w=[].constructor.isArray;function x(t){return null!==t&&"object"==typeof t}function E(t,e){return void 0===e&&(e=0),"string"==typeof t&&t.length>=e}function T(t){return b(t)}function S(t){return w(t)}function k(t,e){return x(t)&&e in t}var N=new(function(){function t(t){this.size=t,this.reset()}return t.prototype.reset=function(){this.oldestIndex=0,this.map={},this.cachedKeys=new Array(this.size)},t.prototype.get=function(t){return this.map[t]},t.prototype.set=function(t,e){this.map[t]=e;var r=this.cachedKeys[this.oldestIndex];void 0!==r&&delete this.map[r],this.cachedKeys[this.oldestIndex]=t,this.oldestIndex++,this.oldestIndex%=this.size},t}())(1e3);function A(t){var e=t.charAt(0),r=t.substr(-1);if("'\"`".includes(e)||"'\"`".includes(r)){if(t.length<2||e!==r)throw new SyntaxError('Mismatching string quotation: "'+t+'"');return t.substring(1,t.length-1)}if(t.includes("["))throw new SyntaxError('Missing ] in varName "'+t+'"');return"+"===e?t.substr(1):t}function P(t,e,r){var n=e.trim();if(""===n)return t;if(n.startsWith(".")){if(!r)throw new SyntaxError('Unexpected . at the start of "'+e+'"');if(""===(n=n.substr(1).trim()))return t}else if(r)throw new SyntaxError('Missing . at the start of "'+e+'"');if(n.endsWith("."))throw new SyntaxError('Unexpected "." at the end of "'+e+'"');for(var o=0,a=n.split(".");o<a.length;o++){var i=a[o].trim();if(""===i)throw new SyntaxError('Empty prop name when parsing "'+e+'"');t.push(i)}return t}function $(t){if(!E(t))throw new TypeError("Cannot parse path. Expected string. Got a "+typeof t);for(var e,r,n=0,o=!1,a=new Array(0),i=0;i<t.length&&-1!==(e=t.indexOf("[",i));i=n){if(-1===(n=t.indexOf("]",e)))throw new SyntaxError('Missing ] in varName "'+t+'"');if(0===(r=t.substring(e+1,n).trim()).length)throw new SyntaxError("Unexpected token ]");n++,P(a,t.substring(i,e),o),a.push(A(r)),o=!0}return P(a,t.substring(n),o)}function G(t,e,r){if(void 0===r&&(r={}),!x(r))throw new TypeError("get expects an object option. Got "+typeof r);var n=r.depth,o=void 0===n?10:n;if(!T(o)||o<=0)throw new RangeError("Expected a positive number for depth. Got "+o);var a=Array.isArray(e)?e:$.cached(e),i=function(){return a.join(" > ")};if(a.length>o)throw new ReferenceError("The path cannot be deeper than "+o+' levels. Got "'+i()+'"');for(var s=t,l=0,c=a;l<c.length;l++){var u=c[l];if(!k(s,u)){if(r.propsExist)throw new ReferenceError(u+' is not defined in the scope at path: "'+i()+'"');return}s=s[u]}return s}$.cached=function(t){var e=N.get(t);return void 0===e&&(e=$(t),N.set(t,e)),e};var O=function(){function t(t,e){var r=this;if(void 0===e&&(e={}),this.tokens=t,this.options=e,this.render=function(t){void 0===t&&(t={});var e=r.tokens.varNames.length;r.cacheParsedPaths();for(var n=new Array(e),o=0;o<e;o++)n[o]=G(t,r.toPathCache[o],r.options);return r.stringify(n)},this.renderFn=function(t,e){void 0===e&&(e={});var n=r.resolveVarNames(t,e);return r.stringify(n)},this.renderFnAsync=function(t,e){return void 0===e&&(e={}),Promise.all(r.resolveVarNames(t,e)).then((function(t){return r.stringify(t)}))},!x(t)||!S(t.strings)||!S(t.varNames)||t.strings.length!==t.varNames.length+1)throw new TypeError("Invalid tokens object");if(!x(e))throw new TypeError("Options should be an object. Got a "+typeof e);e.validateVarNames&&this.cacheParsedPaths()}return t.prototype.cacheParsedPaths=function(){var t=this.tokens.varNames;if(void 0===this.toPathCache){this.toPathCache=new Array(t.length);for(var e=0;e<t.length;e++)this.toPathCache[e]=$.cached(t[e])}},t.prototype.resolveVarNames=function(t,e){void 0===e&&(e={});var r=this.tokens.varNames;if("function"!=typeof t)throw new TypeError("Expected a resolver function. Got "+String(t));for(var n=r.length,o=new Array(n),a=0;a<n;a++)o[a]=t.call(null,r[a],e);return o},t.prototype.stringify=function(t){for(var e=this.tokens.strings,r=this.options.explicit,n=t.length,o="",a=0;a<n;a++){o+=e[a];var i=t[a];(r||null!=i)&&(o+=i)}return o+=e[n]},t}();function j(t,e){void 0===e&&(e={});var r=function(t,e){if(void 0===e&&(e={}),!E(t))throw new TypeError("The template parameter must be a string. Got a "+typeof t);if(!x(e))throw new TypeError("Options should be an object. Got a "+typeof e);var r=e.tags,n=void 0===r?["{{","}}"]:r,o=e.maxVarNameLength,a=void 0===o?1e3:o;if(!S(n)||2!==n.length)throw TypeError("tags should be an array of two elements. Got "+String(n));var i=n[0],s=n[1];if(!E(i,1)||!E(s,1)||i===s)throw new TypeError('The open and close symbols should be two distinct non-empty strings. Got "'+i+'" and "'+s+'"');if(!T(a)||a<=0)throw new Error("Expected a positive number for maxVarNameLength. Got "+a);for(var l,c,u=i.length,d=s.length,p=0,h=[],f=[],v=0;v<t.length&&-1!==(l=t.indexOf(i,v));){var y=l+u;if(-1===(p=t.substr(y,a+d).indexOf(s)))throw new SyntaxError('Missing "'+s+'" in the template for the "'+i+'" at position '+l+" within "+a+" characters");if(p+=y,0===(c=t.substring(y,p).trim()).length)throw new SyntaxError('Unexpected "'+s+'" tag found at position '+l);if(c.includes(i))throw new SyntaxError('Variable names cannot have "'+i+'". But at position '+l+'. Got "'+c+'"');f.push(c),p+=d,h.push(t.substring(v,l)),v=p}return h.push(t.substring(p)),{strings:h,varNames:f}}(t,e);return new O(r,e)}function C(t,e,r){return j(t,r).render(e)}var _=t({emits:["input"],props:{label:{type:String,default:null},buttonType:{type:String,default:null},value:{type:Boolean,default:null},icon:{type:String,default:null},url:{type:String,default:null},method:{type:String,default:"patch"},body:{type:Object,default:null},disabled:{type:Boolean,default:!1},collection:{type:String,required:!0},result:{type:String},headers:{type:Array},primaryKey:{type:[String,Number],required:!0}},setup(t){const{useNotificationsStore:o}=v(),a=o(),i=f(),s=y(),l=e(!1),c=r("values"),{t:u}=m();return{isLoading:l,label:n((()=>C(t.label,c.value))),async click(){l.value=!0;try{const e=c.value;console.log(e);const r=C(t.url,e)||`/items/${t.collection}/${t.primaryKey}`,n=!!t.body&&function(t){try{return JSON.parse(t)}catch(e){return t}}(C(t.body,e)),o=t.method||"patch",u=!!t.headers&&Object.fromEntries(t.headers.map((({key:t,value:r})=>[t,C(r,e)]))),d=await s.request({method:o,url:r,data:n,headers:u});"list"===t.result?i.push(`/content/${t.collection}`):"reload"===t.result?i.go(0):(a.add({title:d.data.title||"Success",text:d.data.text||"Action was completed successfully",type:"success",dialog:!0}),d.data.goto&&i.push(d.data.goto))}catch(t){console.warn(t);const e=t.response?.data?.errors?.[0]?.extensions?.code||t.extensions?.code||"UNKNOWN",r=t.response?.data?.errors?.[0]?.message||t.message||void 0;a.add({title:u(`errors.${e}`),text:r,type:"error",dialog:!0,error:t})}finally{l.value=!1}}}}});var I=[],L=[];!function(t,e){if(t&&"undefined"!=typeof document){var r,n=!0===e.prepend?"prepend":"append",o=!0===e.singleTag,a="string"==typeof e.container?document.querySelector(e.container):document.getElementsByTagName("head")[0];if(o){var i=I.indexOf(a);-1===i&&(i=I.push(a)-1,L[i]={}),r=L[i]&&L[i][n]?L[i][n]:L[i][n]=s()}else r=s();65279===t.charCodeAt(0)&&(t=t.substring(1)),r.styleSheet?r.styleSheet.cssText+=t:r.appendChild(document.createTextNode(t))}function s(){var t=document.createElement("style");if(t.setAttribute("type","text/css"),e.attributes)for(var r=Object.keys(e.attributes),o=0;o<r.length;o++)t.setAttribute(r[o],e.attributes[r[o]]);var i="prepend"===n?"afterbegin":"beforeend";return a.insertAdjacentElement(i,t),t}}("\n.info[data-v-64969d30] {\r\n    --v-button-background-color: var(--blue);\r\n    --v-button-background-color-hover: var(--blue-125);\r\n    --v-button-color: var(--blue-alt);\r\n    --v-button-color-hover: var(--blue-alt);\n}\n.success[data-v-64969d30] {\r\n    --v-button-background-color: var(--success);\r\n    --v-button-background-color-hover: var(--success-125);\r\n    --v-button-color: var(--success-alt);\r\n    --v-button-color-hover: var(--success-alt);\n}\n.warning[data-v-64969d30] {\r\n    --v-button-background-color: var(--warning);\r\n    --v-button-background-color-hover: var(--warning-125);\r\n    --v-button-color: var(--warning-alt);\r\n    --v-button-color-hover: var(--warning-alt);\n}\n.danger[data-v-64969d30] {\r\n    --v-button-icon-color: var(--white);\r\n    --v-button-background-color: var(--danger);\r\n    --v-button-background-color-hover: var(--danger-125);\r\n    --v-button-color: var(--danger-alt);\r\n    --v-button-color-hover: var(--danger-alt);\n}\r\n",{}),_.render=function(t,e,r,n,f,v){const y=o("v-icon"),m=o("v-button");return a(),i("div",null,[s(m,{loading:t.isLoading,onClick:t.click,class:l(t.buttonType),secondary:"primary"!==t.buttonType,icon:!t.label},{default:c((()=>[t.icon?(a(),u(y,{key:0,left:"",name:t.icon},null,8,["name"])):d("v-if",!0),p(" "+h(t.label),1)])),_:1},8,["loading","onClick","class","secondary","icon"])])},_.__scopeId="data-v-64969d30",_.__file="src/interface.vue";var U={id:"action-button",name:"Action Button",description:"Send HTTP requests",icon:"smart_button",component:_,hideLabel:!0,hideLoader:!0,types:["alias"],localTypes:["presentation"],group:"presentation",options:({collection:t})=>[{field:"icon",name:"$t:icon",type:"string",meta:{width:"half",interface:"select-icon"}},{field:"buttonType",name:"$t:type",type:"string",meta:{width:"half",interface:"select-dropdown",default_value:"normal",options:{choices:[{text:"$t:primary",value:"primary"},{text:"$t:normal",value:"normal"},{text:"$t:info",value:"info"},{text:"$t:success",value:"success"},{text:"$t:warning",value:"warning"},{text:"$t:danger",value:"danger"}]}},schema:{default_value:"normal"}},{field:"label",type:"full",name:"$t:label",meta:{width:"full",interface:"system-display-template",options:{collectionName:t,font:"monospace",placeholder:"/items/collection/{{ id }}"}}},{field:"method",name:"Method",type:"string",meta:{width:"half",interface:"select-dropdown",options:{choices:[{text:"GET",value:"GET"},{text:"POST",value:"POST"},{text:"PUT",value:"PUT"},{text:"PATCH",value:"PATCH"},{text:"DELETE",value:"DELETE"}]}}},{field:"url",type:"string",name:"$t:url",meta:{width:"full",interface:"system-display-template",options:{collectionName:t,font:"monospace",placeholder:"/items/collection/{{ id }}"}}},{field:"headers",type:"json",name:"Headers",meta:{width:"full",interface:"list",options:{template:"{{ key }}: {{ value }}",fields:[{field:"key",type:"string",name:"$t:name",meta:{interface:"text",width:"full",options:{font:"monospace",placeholder:"Header"}}},{field:"value",type:"string",name:"$t:value",meta:{width:"full",interface:"system-display-template",options:{collectionName:t,font:"monospace"}}}]}}},{field:"body",type:"text",name:"Body",meta:{width:"full",interface:"input-code"}},{field:"result",name:"On success",type:"string",meta:{width:"full",interface:"select-dropdown",default_value:"popup",options:{choices:[{text:"Show popup",value:"popup"},{text:"Go to list",value:"list"},{text:"Reload current item",value:"reload"}]}},schema:{default_value:"popup"}}]};export{U as default};
